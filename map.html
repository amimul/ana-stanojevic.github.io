<!DOCTYPE html>
<meta charset="utf-8"
      name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

  <link rel="stylesheet" href="src/map.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
  <script src="https://d3js.org/topojson.v1.min.js"></script>
	<script type="text/javascript" src="https://rawgit.com/stamen/maps.stamen.com/master/js/tile.stamen.js"></script>

  <div id='map' class="map"></div>

  <script>
    const descr1 = ".335-.999 mm",
          descr2 = "1.00-4.75 mm",
          desc3 = "4.75-200 mm",
          desc4 = ">200 mm";
    let color_map = {
      1:"teal",
      2:"tomato",
      3:"sienna",
      4:"saddlebrown",
      5:"red",
      6:"purple",
      7:"orange",
      8:"olivedrab",
      9:"navy",
      10:"mediumvioletred",
      11:"maroon",
      12:"lime",
      13:"lightpink",
      14:"lightcoral",
      15:"indigo",
      16:"forestgreen",
      17:"dimgray",
      18:"darkslategray",
      19:"darkred",
      20:"yellowgreen",
      21:"Turquoise",
      22:"yellow",
      23:"Thistle",
      24:"tan",
      25:"stringgreen",
      26:"Acajou",
      27:"AlabamaCrimson",
      28:"AlloyOrange",
      29:"FuchsiaPurple",
      30:"Fulvous",
      31:"CadetBlue",
      32:"Chartreuse",
      33:"Chocolate",
      34:"CrnflowerBlue",
      35:"Crimson",
      36:"DarkCyan",
      37:"DarkGray",
      38:"DarkKhaki",
      39:"DarkOrchid",
      40:"DarkSalmon",
      41:"DarkSlateBlue",
      42:"DarkSlateGray"
    };
  const radius = 1.05;
  const expedition_data_dir = "data/expeditions/"
  const expedition_csv = "data/expeditions/expedition_01.csv"
  map = new L.map('map', {
    attribution: 'attribution line',
    attributionControl: false
  }).setView([0, 0], 3);
  stamen = new L.StamenTileLayer("watercolor");
  map.addLayer(stamen);
	L.control.attribution({position: 'bottomright'})
           .addAttribution("&copy; <a href='http://osm.org/copyright'>OpenStreetMap</a>, <a href='http://maps.stamen.com'>Stamen</a>, <a href='http://maquest.com'>MapQuest</a>")
           .setPrefix("")
           .addTo(map);
  var svg = d3.select(map.getPanes().overlayPane).append("svg"),
      g = svg.append("g").attr("class", "leaflet-zoom-hide");
  svg.attr("width", window.innerWidth);
  svg.attr("height", window.innerHeight);
  function projectPoint(x, y) {
    return map.latLngToLayerPoint(new L.LatLng(y, x));
  }
  let line = d3.line()
               .curve(d3.curveLinear)
               .x(function(d) {
                  long = parseFloat(d.Longitude.replace(',','.').replace(' ',''));
                  return projectPoint(long, 1).x; })
               .y(function(d) {
                  lat = parseFloat(d.Latitude.replace(',','.').replace(' ',''));
                  return projectPoint(1, lat).y; });
    d3.text(expedition_csv, function(error, raw) {
        let dsv = d3.dsvFormat(';')
        let data = dsv.parse(raw);
        let _g = d3.select("g");
        _g.selectAll("circle")
          .data(data).enter()
          .append("circle")
          .style("fill", "tomato")
          .attr("r", 2)
          .attr("cx", function(d){
            long = parseFloat(d.Longitude.replace(',','.').replace(' ',''))
            return projectPoint(long, 1).x
          })
          .attr("cy", function(d){
            lat = parseFloat(d.Latitude.replace(',','.').replace(' ',''))
            return projectPoint(1, lat).y
          });
        _g.append("path")
          .datum(data)
          .attr("fill", "none")
          .attr("stroke", "steelblue")
          .attr("stroke-linejoin", "round")
          .attr("stroke-linecap", "round")
          .attr("stroke-width", 1.5)
          .attr("d", line);
    });
  </script>
</body>
